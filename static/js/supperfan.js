var chat=new CuttleChat,leaderboard=[],textarea_topic=document.getElementById("textarea_topic"),textarea_question=document.getElementById("textarea_question"),button_chat_choose=document.getElementById("button_chat_choose"),overlay_choose=document.getElementById("overlay_choose"),overlay_choose_close=document.getElementById("overlay_choose_close"),input_answer=document.getElementById("input_answer"),button_show=document.getElementById("button_show"),button_start=document.getElementById("button_start"),
button_next_question=document.getElementById("button_next_question"),content_correctboard=document.getElementById("content_correctboard"),content_leaderboard=document.getElementById("content_leaderboard"),button_collect=document.getElementById("button_collect"),height_calc=document.getElementById("height_calc"),array_choices=[];textarea_topic.addEventListener("focus",handleFocus,!1);textarea_topic.addEventListener("keydown",modifyTextarea,!1);
textarea_question.addEventListener("focus",handleFocus,!1);textarea_question.addEventListener("keydown",modifyTextarea,!1);button_show.addEventListener("click",toggleViewAnswer,!1);button_start.addEventListener("click",startReading,!1);button_next_question.addEventListener("click",nextQuestion,!1);button_collect.addEventListener("click",collectChoices,!1);textarea_topic.addEventListener("focus",function(){button_chat_choose.style.display="inline-block"},!1);
textarea_topic.addEventListener("blur",function(){button_chat_choose.style.display="none";""==this.value&&(this.placeholder="NO-TOPIC")},!1);textarea_question.addEventListener("blur",function(){""==this.value&&(this.placeholder="?")},!1);button_chat_choose.addEventListener("mousedown",function(){overlay_choose.style.display="block"},!1);
overlay_choose_close.addEventListener("click",function(){overlay_choose.style.display="none";for(var a=0;5>a;a++)document.getElementsByClassName("input_choice")[a].readOnly=!1,document.getElementsByClassName("input_choice")[a].value="",document.getElementsByClassName("votes_choice")[a].innerHTML="Votes:";button_collect.innerHTML="Start collecting chat choices";array_choices=[];participants=[]},!1);function limitIndex(a,b){return a<=b?a:b}function handleFocus(){this.placeholder=""}
function modifyTextarea(){height_calc.style.fontSize=getComputedStyle(this).fontSize;height_calc.style.lineHeight=getComputedStyle(this).lineHeight;height_calc.style.textTransform=getComputedStyle(this).textTransform;height_calc.innerHTML=this.value+" x";this.style.height=height_calc.scrollHeight+"px"}function openOverlay(){}function toggleViewAnswer(){"text"===input_answer.type?(input_answer.type="password",button_show.innerHTML="SHOW"):(input_answer.type="text",button_show.innerHTML="HIDE")}
function updateLeaderboard(){var a=1;content_leaderboard.innerHTML="";leaderboard.sort(function(a,b){return b.points-a.points});for(var b=0;b<limitIndex(leaderboard.length,5);b++){var d=document.createElement("span");d.className="rank_user";d.innerHTML=a+". "+leaderboard[b].username;var g=document.createElement("span");g.className="rank_points";g.innerHTML=leaderboard[b].points;content_leaderboard.appendChild(d);content_leaderboard.appendChild(g);a++}}
function startReading(){if(""===input_answer.value)input_answer.placeholder="Please write the correct answer";else{input_answer.type="password";input_answer.readOnly=!0;button_show.innerHTML="SHOW";var a=input_answer.value.toLowerCase(),b=[],d=1,g=new Date;chat.open(function(f,c){var e=b.indexOf(f);c=c.toLowerCase();if(-1===e&&c==a){e=(new Date).getTime()-g.getTime();e=Math.round(3E5/e+1E3/d);b.push(f);var h=document.createElement("span");h.className="rank_user";h.innerHTML=d+". "+f;var k=document.createElement("span");
k.className="rank_points";k.innerHTML=e;content_correctboard.appendChild(h);content_correctboard.appendChild(k);d++;h=leaderboard.findIndex(function(a){return a.username===f});0<=h?leaderboard[h].points+=e:leaderboard.push({username:f,points:e});updateLeaderboard();5==b.length&&(textarea_question.value="Fastest responses found!",chat.close())}});textarea_question.value="Waiting for correct responses";button_start.style.display="none";button_next_question.style.display="inline-block"}}
function nextQuestion(){chat.close();input_answer.value="";input_answer.placeholder="Write the correct answer";input_answer.readOnly=!1;input_answer.type="password";button_show.innerHTML="SHOW";content_correctboard.innerHTML="";button_next_question.style.display="none";button_start.style.display="inline-block";textarea_question.value="Click to write a question"}function compareArray(a,b){return a[1]===b[1]?0:a[1]<b[1]?-1:1}
function collectChoices(){if(0>=array_choices.length){for(var a=document.getElementById("choice_one"),b=document.getElementById("choice_two"),d=document.getElementById("choice_three"),g=document.getElementById("choice_four"),f=document.getElementById("choice_five"),c=0;5>c;c++)document.getElementsByClassName("input_choice")[c].readOnly=!0;array_choices=[[a.value,0],[b.value,0],[d.value,0],[g.value,0],[f.value,0]];var e=[];button_collect.dataset.choice=a.value;button_collect.innerHTML="Waiting";chat.open(function(a,
b){var c=b.charAt(0),d=e.indexOf(a);-1<"12345".indexOf(c)&&-1===d&&(array_choices[c-1][1]+=1,document.getElementsByClassName("votes_choice")[c-1].innerHTML="Votes: "+array_choices[c-1][1],array_choices.sort(compareArray),e.push(a),button_collect.dataset.choice=array_choices[4][0],button_collect.innerHTML="Choose: "+array_choices[4][0])})}else{chat.close();textarea_topic.value=button_collect.dataset.choice;overlay_choose.style.display="none";for(c=0;5>c;c++)document.getElementsByClassName("input_choice")[c].readOnly=
!1,document.getElementsByClassName("input_choice")[c].value="",document.getElementsByClassName("votes_choice")[c].innerHTML="Votes:";button_collect.innerHTML="Start collecting chat choices";array_choices=[];e=[]}};
